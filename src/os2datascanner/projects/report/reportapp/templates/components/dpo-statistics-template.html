{% load i18n %}
{% load l10n %}
{% load static %}

<div class="content" hx-push-url="true">
  <div class="content-header">
    <h1 class="page-title">{% trans "DPO statistics" %}</h1>

    <svg class="page-indicator"
         id="report-page-indicator"
         viewbox="0 0 100 100">
      <circle id="circle" cx="50" cy="50" r="45"></circle>
    </svg>

    <!-- Scannerjob chart data selection -->
    <form name="stat_form"
          hx-get="{% url "statistics-dpo" %}"
          hx-target=".content"
          hx-select=".content"
          hx-swap="outerHTML"
          hx-trigger="change"
          hx-indicator="#report-page-indicator">
      <div class="dropdown stats_dropdown">
        <select name="scannerjob" id="scannerjobs" data-compareto="all">
          <option value="all"
                  {% if scannerjobs|last == "all" %} selected="selected"{% endif %}>
            {% trans "All scannerjobs" %}
          </option>
          {% for scan in scannerjobs|first %}
            <option value="{{ scan.scanner_job_pk|unlocalize }}"
                    {% if scannerjobs|last == scan.scanner_job_pk|stringformat:"i" %} selected="selected" {% endif %}>
              {{ scan.scanner_job_name }}
            </option>
          {% endfor %}
        </select>
      </div>
    </form>
  </div>

  <div class="statistic_wrapper">

    <!-- Line chart -->
    <div class="statistic">
      <div class="statistic_header">
        <div>
          <h1 class="page-title__sub">{% trans "Development overview" %}</h1>
          <p class="chart_description" data-chartid="development-new-results">{% trans "New results by month" %}</p>
          <p class="hidden chart_description"
             data-chartid="development-unhandled-results">
            {% trans "Unhandled results by month" %}
          </p>
        </div>
        <div class="statistic_header_nav">
          <div class="dropdown">
            <select>
              <option value="development-new-results">
                {% trans "New results" %}
              </option>
              <option value="development-unhandled-results">
                {% trans "Unhandled results" %}
              </option>
            </select>
          </div>
        </div>
      </div>
      <div class="chart_container" data-chartid="development-new-results">
        <canvas class="line_chart" id="line_chart_new_matches_by_month"></canvas>
      </div>
      <div class="hidden chart_container"
           data-chartid="development-unhandled-results">
        <canvas class="line_chart" id="line_chart_unhandled_matches"></canvas>
      </div>
    </div>

    <!-- Pie chart -->
    <div class="statistic">
      <div class="statistic_header">
        <div>
          <h1 class="page-title__sub">{% trans "Distribution of results" %}</h1>
          <p class="chart_description" data-chartid="distribution-sensitivities">
            {% trans "Results distributed by sensitivities" %}
          </p>
          <p class="hidden chart_description"
             data-chartid="distribution-data-sources">
            {% trans "Results distributed by data sources" %}
          </p>
          <p class="hidden chart_description"
             data-chartid="distribution-resolution-status">
            {% trans "Results distributed by resolution statuses" %}
          </p>
        </div>
        <div class="statistic_header_nav">
          <div class="dropdown">
            <select>
              <option value="distribution-sensitivities">
                {% trans "Sensitivity" %}
              </option>
              <option value="distribution-data-sources">
                {% trans "Data sources" %}
              </option>
              {% if handled_matches_status|last > 0 %}
                <option value="distribution-resolution-status">
                  {% trans "Resolution statuses" %}
                </option>
              {% endif %}
            </select>
          </div>
        </div>
      </div>
      <div class="pie_chart_container chart_container"
           data-chartid="distribution-sensitivities">
        <div>
          <canvas id="pie_chart_sensitivity"></canvas>
        </div>
        <div id="pie_legend_sensitivity"></div>
      </div>
      <div class="hidden pie_chart_container chart_container"
           data-chartid="distribution-data-sources">
        <div>
          <canvas id="pie_chart_datasources"></canvas>
        </div>
        <div id="pie_legend_datasources"></div>
      </div>
      <div class="hidden pie_chart_container chart_container"
           data-chartid="distribution-resolution-status">
        <div>
          <canvas id="pie_chart_resolution_status"></canvas>
        </div>
        <div id="pie_legend_resolution_status"></div>
      </div>
    </div>
 
    <!-- Doughnut chart -->
    <div class="statistic">
      <div class="statistic_header">
        <div>
          <h1 class="page-title__sub">{% trans "Handled results" %}</h1>
          <p class="chart_description" data-chartid="handling-all-results">
            {% trans "The department's percentage of handled results" %}
          </p>
        </div>
      </div>
      <div class="chart_container" data-chartid="handling-all-results">
        <div class="doughnut_chart_container">
          <div>
            <canvas id="doughnut_chart_total"></canvas>
          </div>
          <div class="doughnut_info_box">
            <h4>{% trans "Handled results" %}</h4>
            <p>{{ total_handled_matches }} {% trans "of" %} {{ total_matches }}</p>
          </div>
        </div>

      </div>
    </div>
    {% comment %}
    <!-- Bar chart -->
    <div class="statistic statistic--four">
      <div class="statistic_header">
        <div>
          <h1 class="page-title__sub">{% trans "Development overview" %}</h1>
          <p class="chart_description">{% trans "Overview for department with most unhandled results" %}</p>
          <p class="hidden chart_description">{% trans "Overview for departments with the oldest results" %}</p>
        </div>
        <div class="statistic_header_nav"></div>
      </div>
      <div>
        <h1 class="page-title__sub">{% trans "Comming soon" %}</h1>
      </div>
    </div>
    {% endcomment %}
  </div>
  {{ sensitivities|json_script:"sensitivities" }}
  {{ source_types|json_script:"source_types" }}
  {{ handled_matches|json_script:"handled_matches" }}
  {{ new_matches_by_month|json_script:"new_matches_by_month" }}
  {{ unhandled_matches_by_month|json_script:"unhandled_matches_by_month" }}
  {{ handled_matches_status|json_script:"handled_matches_status" }}
</div>
