{% load handle_extras %}
{% load i18n %}
{% load l10n %}
{% with type=match.matches.handle|find_type_label %}
  {% for frag in match.matches.matches %}
    {% if frag.rule.type_label in renderable_rules and frag.matches %}
      <tr data-type="{{ type }}">
        <td>
          <div class="datatable__column--filetype-icon">
            <input type="checkbox" value="" name="match-checkbox" class="datatable-checkbox" data-report-pk="{{ match.pk|unlocalize }}">
          </div>
        </td>

        <td>
          <strong>{{ match.matches.handle.name }}</strong>

          <div class="hit-link">
            <div class="button-group">
              {% if match.matches.handle|present_url %}
                <a href="{{ match.matches.handle|present_url }}" class="button" target="_blank" rel="noopener">
                  {% trans "Open" %}
                </a>
              {% endif %}
              {% if type != 'ews' %}
                <button class="button" data-clipboard-text="{{ match.matches.handle|find_parent:type|present }}">
                  {% trans "Copy" %}
                </button>
                {% if match.matches.handle|find_parent:type|find_file_folder %}
                  <a href="{{ match.matches.handle|find_parent:type|find_file_folder }}" class="button" target="_blank" rel="noopener">
                    {% trans "Open folder" %}
                  </a>
                {% endif %}
              {% endif %}
            </div>
          </div>
        </td>

        <td>
          {{ frag.matches|length }}
        </td>

        <td>
          <span class="icon-filetype icon-filetype--{{ type }}">
          {% with svg_icon=type|find_svg_icon %}
            {% include svg_icon %}
          {% endwith %}
          </span>
        </td>

        <td>
          {{ match.matches.handle|present }}
        </td>

        <td>
          <div class="button-group matches-actions">
            <button class="matches-handle button screen-reader-only-focusable" type="button">{% trans "Handle" %}</button>
            <button class="matches-expand button caret" aria-label="{% trans 'Show/hide matches' %}" type="button"></button>
          </div>
        </td>
      </tr>
      <tr class="matches-list" hidden>
        <td colspan="6">
          <table class="smaller datatable compressed">
            <colgroup>
              <col class="matches-list__column--match">
              <col class="matches-list__column--context">
            </colgroup>
            <thead>
              <th>{% trans "Anonymized match" %}</th>
              <th>{% trans "Context" %}</th>
            </thead>
            <tbody>
              {% for match in frag.matches %}
                <tr>
                  <td>{{ match.match }}</td>
                  {% if match.context %}
                  <td class="match-context">{{ match.context }}</td>
                  {% endif %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </td>
      </tr>
    {% endif %}
  {% endfor %}
{% endwith %}
