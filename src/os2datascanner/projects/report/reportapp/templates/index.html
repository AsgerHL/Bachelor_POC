{% include "partials/header.html" %}
{% include "components/banner.html" %}
<script>
function clear_filter(elementid){
    document.querySelector('#' + elementid + ' [value="all"]').selected = true;
    document.getElementById("filter_form").submit();
};
</script>

    <main class="wrapper">
      {% include "partials/sidemenu.html" with active_tab="home" %}
      <div class="content">
        <span class="matches">
          <span>Matches</span>
          <i class="matches--width material-icons">chevron_right</i>
          <span class="matches--width">Samlede antal: {{ page_obj.paginator.count }}</span>
        </span>

        <h1 class="page-title">Matches </h1>
          <form method="GET" action="{% url 'index' %}" id="filter_form">
              <div class="match_filtering_wrapper">
                  <div>
                      <button type="button" onclick="clear_filter('scannerjobs')" class="match_filtering_clear_button">Ryd</button>
                      <label for="scannerjobs" class="match_filtering_label">Scan</label>
                  </div>
                  <div class="match_filtering" style="width: 200px; height: 35px;">
                      <select name="scannerjob" id="scannerjobs" onchange="this.form.submit()" >
                        <option value="all"
                                {% if scannerjobs|last == "all" %}
                                    selected="selected"
                                {% endif %} >
                                Vælg scannerjob
                        </option>
                          {% for scan in scannerjobs|first %}
                              <option value="{{ scan.data__scan_tag__scanner__pk }}"
                                      {% if scannerjobs|last == scan.data__scan_tag__scanner__pk|stringformat:"i" %}
                                        selected="selected"
                                      {% endif %} >
                                  {{ scan.data__scan_tag__scanner__name }} ({{ scan.total }})
                              </option>
                           {% endfor %}
                      </select>
                  </div>
              </div>
              <div style="float:left;">
                  <div>
                      <button type="button" onclick="clear_filter('sensitivities')" class="match_filtering_clear_button">Ryd</button>
                      <label for="sensitivities" class="match_filtering_label">Følsomhed</label>
                  </div>
                  <div class="match_filtering" style="width: 200px;">
                      <select name="sensitivities" id="sensitivities" onchange="this.form.submit()" >
                        <option value="all"
                                {% if sensitivities|last == "all" %}
                                    selected="selected"
                                {% endif %} >
                          Vælg følsomhed
                        </option>
                          {% for sensitivity in sensitivities|first %}
                              <option value="{{ sensitivity.0.value|stringformat:"i" }}"
                                    {% if sensitivities|last == sensitivity.0.value|stringformat:"i" %}
                                        selected="selected"
                                    {% endif %} >
                                    {{ sensitivity.0.presentation }}
                                    ({{ sensitivity.1 }})
                              </option>
                           {% endfor %}
                      </select>
                  </div>
              </div>
         </form>

        {% include "components/hits.html" %}
      </div>

    </main>

    <script>
      var x, i, j, l, ll, selElmnt, a, b, c;
/*look for any elements with the class "custom-select":*/
x = document.getElementsByClassName("match_filtering");
l = x.length;
for (i = 0; i < l; i++) {
  selElmnt = x[i].getElementsByTagName("select")[0];
  ll = selElmnt.length;
  /*for each element, create a new DIV that will act as the selected item:*/
  a = document.createElement("DIV");
  a.setAttribute("class", "select-selected");
  a.innerHTML = selElmnt.options[selElmnt.selectedIndex].innerHTML;
  x[i].appendChild(a);
  /*for each element, create a new DIV that will contain the option list:*/
  b = document.createElement("DIV");
  b.setAttribute("class", "select-items select-hide");
  for (j = 1; j < ll; j++) {
    /*for each option in the original select element,
    create a new DIV that will act as an option item:*/
    c = document.createElement("DIV");
    c.innerHTML = selElmnt.options[j].innerHTML;
    c.addEventListener("click", function(e) {
        /*when an item is clicked, update the original select box,
        and the selected item:*/
        var y, i, k, s, h, sl, yl;
        s = this.parentNode.parentNode.getElementsByTagName("select")[0];
        sl = s.length;
        h = this.parentNode.previousSibling;
        for (i = 0; i < sl; i++) {
          if (s.options[i].innerHTML == this.innerHTML) {
            s.selectedIndex = i;
            h.innerHTML = this.innerHTML;
            y = this.parentNode.getElementsByClassName("same-as-selected");
            yl = y.length;
            for (k = 0; k < yl; k++) {
              y[k].removeAttribute("class");
            }
            this.setAttribute("class", "same-as-selected");
            break;
          }
        }
        h.click();
    });
    b.appendChild(c);
  }
  x[i].appendChild(b);
  a.addEventListener("click", function(e) {
      /*when the select box is clicked, close any other select boxes,
      and open/close the current select box:*/
      e.stopPropagation();
      closeAllSelect(this);
      this.nextSibling.classList.toggle("select-hide");
      this.classList.toggle("select-arrow-active");
    });
}
function closeAllSelect(elmnt) {
  /*a function that will close all select boxes in the document,
  except the current select box:*/
  var x, y, i, xl, yl, arrNo = [];
  x = document.getElementsByClassName("select-items");
  y = document.getElementsByClassName("select-selected");
  xl = x.length;
  yl = y.length;
  for (i = 0; i < yl; i++) {
    if (elmnt == y[i]) {
      arrNo.push(i)
    } else {
      y[i].classList.remove("select-arrow-active");
    }
  }
  for (i = 0; i < xl; i++) {
    if (arrNo.indexOf(i)) {
      x[i].classList.add("select-hide");
    }
  }
}
/*if the user clicks anywhere outside the select box,
then close all select boxes:*/
document.addEventListener("click", closeAllSelect);
    </script>
    {% include "partials/scripts.html" %}

</body>
</html>