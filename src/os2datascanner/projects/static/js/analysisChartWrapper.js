
const BarData = [
  {"type": "image/png",
  "sizes": [3277, 3277, 5602, 6445, 6562, 7628, 7628, 8580, 8810, 9215, 9215, 9327, 9327, 9332, 9692, 9692, 10104, 10104, 10976, 10976, 11000, 11924, 11924, 15220, 16065, 16526, 18802, 19179, 19467, 19479, 19660, 20009, 20415, 20518, 22256, 23085, 23284, 23350, 23569, 23569, 23856, 23856, 23927, 23927, 25048, 25547, 25822, 26996, 28514, 29631, 30320, 34308, 34583, 35413, 35926, 37458, 38138, 38806, 39718, 40013, 40576, 40576, 42110, 42395, 43003, 45548, 46026, 46956, 47331, 47899, 48317, 49469, 50996, 53254, 56236, 58005, 58827, 61846, 62350, 62442, 62969, 67967, 72741, 77919, 80844, 82257, 84600, 84810, 86197, 87728, 94500, 99831, 103687, 103765, 107718, 108610, 110496, 110956, 114543, 118461, 119728, 127722, 131972, 135053, 140617, 141727, 153102, 163026, 191903, 203252, 205843, 235927, 246579, 267507, 274487, 462178, 463401, 463401, 464271, 487693, 529575, 598726, 631091, 687165, 715636]
  },
  {"type": "image/jpeg",
  "sizes": [12813, 13340, 20044, 20585, 22837, 29321, 29321, 30856, 31780, 31780, 32524, 33000, 33000, 33208, 34204, 35239, 36702, 37299, 38591, 38689, 40854, 43636, 43878, 44699, 44807, 46621, 49826, 52288, 52653, 53321, 55045, 56119, 56205, 58232, 59113, 59113, 61051, 65162, 65162, 66758, 66758, 67001, 67001, 67774, 67774, 67934, 69867, 73110, 74439, 74439, 74516, 74516, 75016, 75016, 77068, 78135, 78135, 78410, 78410, 78468, 78839, 78839, 80376, 80376, 82218, 82218, 82563, 82563, 83098, 84051, 84051, 84362, 84362, 86370, 86370, 86561, 86833, 86833, 87888, 87888, 88281, 88281, 88418, 88944, 88944, 89064, 89829, 89846, 89846, 89951, 89951, 91208, 91208, 92666, 92666, 93664, 93664, 93924, 93924, 94460, 94460, 96305, 96305, 96817, 96817, 97843, 97843, 98987, 99240, 99240, 100612, 101063, 101063, 101879, 101879, 102321, 102321, 103175, 103175, 103238, 103870, 103870, 104329, 104329, 104608, 104608, 105892, 105892, 105905, 105905, 106604, 106604, 108433, 108433, 108515, 108515, 109496, 109496, 111086, 111086, 115186, 115186, 117086, 117086, 117920, 117920, 118261, 118261, 119910, 119910, 120723, 120723, 120759, 120759, 124047, 125150, 125150, 126723, 126723, 129580, 129580, 131046, 131046, 133984, 133984, 135015, 138700, 138700, 138877, 138877, 142264, 142264, 143093, 144029, 144029, 150596, 151838, 153468, 153468, 163945, 166882, 166882, 166974, 175446, 175446, 177397, 214012, 216876, 216876, 236180, 248105, 248105, 259932, 259932, 265981, 267609, 267609, 291426, 309473, 309473, 310110, 310110, 333168, 333168, 340690, 340690, 352400, 378241, 378241, 383773, 383773, 385520, 385520, 393592, 397731, 397731, 422172, 422172, 422361, 422361, 447746, 447746, 457652, 457652, 459962, 459962, 461758, 461758, 464825, 464825, 470347, 470347, 473287, 473287, 476675, 476675, 480406, 480406, 482305, 482305, 498712, 498712, 502468, 502468, 506163, 506163, 510767, 510767, 514408, 514408, 535536, 535536, 540309, 540309, 541765, 541765, 557176, 557176, 559661, 559661, 564385, 564385, 575371, 575371, 589122, 596544, 596544, 635058, 635058]
  },
  {"type": "PDF",
  "sizes": [678423,83523,586045,393947,470404,412541, 736222, 652321, 530723, 194094, 211932, 714915, 375268, 412209, 189560, 704106, 94267, 596858, 689670, 708537, 741939, 751743, 679466, 274276, 356797, 124987, 435247, 696197, 132523, 769959, 80683, 694238, 221632, 637463, 423812, 135387, 754801, 168449, 654236, 373358, 419734, 418310, 539423, 80347, 145626, 738416, 405811, 717525, 755953, 571319, 218603, 337923, 511652, 660573, 417893, 678608, 570992, 112469, 310543, 289163, 491145, 439459, 429626, 589215, 364829, 701506, 129382, 230131, 781817, 688584, 610341, 429722, 595607, 627370, 732125, 88483, 651226, 237027, 679984, 250420, 673301, 740072, 503518, 473858, 274209, 633002, 717201, 293236, 731193, 191343, 190414, 390066, 399596, 629851, 269728, 494258, 128300, 706440, 138654, 106827, 85009, 726515, 293658, 519257, 386506, 643874, 502470, 732633, 700187, 140829, 552332, 303451, 455053, 632837, 277296, 676614, 88735, 585980, 201469, 201816, 552452, 289276, 237813, 121369, 580243, 265474, 644348, 444410, 289960, 626478, 588100, 439240, 147712, 201658, 284170, 605394, 334466, 721336, 677357, 428116, 120470, 210161, 727784, 243071, 587130, 113079, 558130, 347748, 698568, 681709, 657551, 528261, 698090, 127677, 535053, 732294, 290798, 575468, 309421, 225279, 200410, 513271, 799914, 351024, 452668, 558428, 738480, 550899, 349970, 245636, 561588, 613722, 232104, 507888, 137119, 247874, 82930, 531547, 640840, 395643, 741987, 286095, 185383, 178853, 512258, 771022, 355934, 752652, 316957, 196172, 171708, 603308, 676511, 683015, 156704, 238029, 268399, 386164, 350131, 338384, 141623, 727474, 111895, 505291, 393756, 196480, 253506, 681229, 225092, 718972, 358324, 93686, 729113, 671979, 445251, 95075, 94432, 415516, 280359, 132160, 242628, 667091, 187527, 322249, 322050, 536953, 796713, 321164, 406627, 321593, 474696, 442861, 795418, 416403, 58532, 363174, 230285, 192252, 368530, 641852, 164759, 737102, 272493, 227442, 93927, 510992, 167984, 542897, 592857, 701837]
  },
  {"type": "XLS",
  "sizes": [43850, 16106, 41454, 12272, 34803, 6669, 10133, 41352, 40600, 26013, 9048, 2621, 59721, 33353, 50416, 9422, 38091, 9043, 52864, 8292, 19272, 3287, 54292, 9346, 57198, 25480, 5390, 23639, 34827, 39369, 45881, 54910, 54980, 18804, 24090, 54201, 14824, 33902, 51741, 15877, 43791, 42628, 25525, 8355, 1536, 54796, 58793, 211, 44416, 34803, 52669, 32306, 11460, 42359, 8056, 31411, 33059, 9422, 49408, 22349, 8609, 43064, 13143, 28543, 57893, 55480, 51966, 45100, 57510, 35115, 44691, 433, 11836, 35149, 15864, 22612, 43534, 44605, 27321, 4476, 27757, 19476, 8890, 42893, 14172, 52948, 49587, 21532, 4836, 15395, 23854, 47147, 47429, 52958, 2252, 22468, 24789, 22782, 534, 35721, 36585, 40112, 13688, 54747, 39016, 37299, 37923, 42369, 42851, 31694, 8435, 20258, 33982, 51681, 22966, 18308, 21909, 55795, 48746, 25050, 49564, 31928, 37386, 59224, 23022, 48701, 15009, 25846, 38800, 17280, 871, 47199, 57797, 7715, 43547, 23999, 9773, 35504, 32775, 13292, 17245, 24092, 32508, 47538, 19883, 7211, 7479, 5679, 13637, 24058]
  },
  {"type": "TXT",
  "sizes": [210990, 507110, 423710, 541480, 33560, 540770, 65920, 363100, 208930, 369200, 557150, 391120, 270410, 491640, 471990, 598770, 152730, 425300, 52050, 36530, 40074, 54951, 50129, 268550, 35316, 995, 461750, 25853, 235770, 3240, 208680, 279070, 571420, 148400, 471850, 316480, 19550, 52293, 424060, 38650, 414300, 79050, 472620, 584120, 384520, 43624, 27443, 56452, 25570, 463460, 97440, 58660, 20233, 44942, 285370, 28327, 430030, 76410, 540910, 589240, 559640, 49717, 341150, 117850, 1280, 228710, 435780, 187530, 131520, 563340, 287630, 119190, 209060, 520400, 538130, 106120, 107970, 327380, 267680, 225100, 529740, 72840, 522190, 5874, 403900, 553920, 113070, 41500, 400040, 50780, 40540, 197280, 94060, 348010, 479550, 498590, 217640, 3380, 395180, 311700, 405490, 9686, 14766, 23321, 261, 223570, 474870, 152280, 52760, 154260, 97840, 120990, 48907, 58007, 980, 46545, 38857, 27501, 19883, 27016, 24466, 11869, 59995, 25245, 308550, 515610, 385340, 291820, 2354, 42060, 37876, 45137, 2447, 32791, 19207, 11960, 33178, 16524, 42343, 55189, 13303, 17814, 50796, 8240, 24368, 29390, 34932, 55887, 40161, 36016]
  }
];

const PieData = [
  {
      "type": "Image/png",
      "n_files":69, 
      "total_size":9720239, 
      "mean":140873, 
      "median":21267, 
      "min":736, 
      "max":1832836,
  },
  {
      "type":"Image/jpeg",
      "n_files":118, 
      "total_size":45597233, 
      "mean":386417, 
      "median":169746, 
      "min":2845, 
      "max":9355552,
  },
  {
      "type":"PDF",
      "n_files":82, 
      "total_size":10765558, 
      "mean":131287, 
      "median":120333, 
      "min":5362, 
      "max":264511,
  },
  {
      "type":"XLS",
      "n_files":105, 
      "total_size":31064800, 
      "mean":295855, 
      "median":118202, 
      "min":1213, 
      "max":212369,
  },
  {
      "type":"TXT",
      "n_files":135, 
      "total_size":12161999, 
      "mean":90088, 
      "median":92354, 
      "min":11234, 
      "max":150364,
  }
];

function drawBars(jsonData){
  jsonData.forEach((dataset, i) => {
    let ctx = document.getElementById("bar"+(i+1).toString());
    let [data, binSize] = getData(dataset.sizes);
    let title = dataset.type.charAt(0).toUpperCase() + dataset.type.slice(1);
    charts.push(createBars(data, ctx, title, binSize));
  });
}

function drawPies(Data, colors) {
  var ctx1 = document.getElementById("pie1");
  var ctx2 = document.getElementById("pie2");
  let types = Data.map(object => object.type);
  let nFiles = Data.map(object => object.n_files); // jshint ignore:line
  let totalSize = Data.map(object => object.total_size); // jshint ignore:line
  let pie1Data = {labels: types, data: nFiles, name: "nfiles", title: gettext("Number of files")};
  let pie2Data = {labels: types, data: totalSize, name: "storage", title: gettext("Storage space")};
  charts.push(createPie(pie1Data, [ctx1, "pie1"], colors));
  charts.push(createPie(pie2Data, [ctx2, "pie2"], colors));
}

let colorList = ["rgba(84, 71, 140)", 
"rgba(44, 105, 154)",
"rgba(4, 139, 168)",
"rgba(13, 179, 158)",
"rgba(22, 219, 147)",
"rgba(131, 227, 119)",
"rgba(185, 231, 105)",
"rgba(239, 234, 90)",
"rgba(241, 196, 83)"];


function clearCharts() {
    for (let chart of charts) {
      chart.destroy();
    }
    charts.length = 0;
  }  


document.addEventListener('DOMContentLoaded', function () {
    window.charts = [];
    drawPies(PieData, colorList);
    drawBars(BarData);
});

    
htmx.onLoad(function () {
    clearCharts();
    drawPies(PieData, colorList);
    drawBars(BarData);
});

          
